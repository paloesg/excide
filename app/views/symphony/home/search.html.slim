.row
  .col-sm-12
    ol.breadcrumb
      li.breadcrumb-item.ml-auto
        a href="#" Home
      li.breadcrumb-item
        a href="#" #{current_user.company.name}
      li.breadcrumb-item.active Search
    h1 Search Workflows

.row
  .col-sm-6.offset-sm-6
    input.form-control#q type="search"
    br

.row
  .col-sm-3#facets
    #templates
  .col-sm-9
    .card
      .card-header
        h5 Search results
      .table-responsive#hits

script src='//cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.js'

javascript:
  $(document).ready(function() {
    var hitTemplate = '<table class="table table-striped">' +
      '<thead><tr><th>Workflow Identifier</th>' +
      '<th>Workflow Type</th>' +
      '<th>Client Name</th>' +
      '<th>Deadline</th>' +
      '<th>Status</th></tr></thead>' +
      '<tbody>{{#hits}}' +
      '<tr><td><a href="/symphony/{{{template.slug}}}/{{{identifier}}}">{{{_highlightResult.identifier.value}}}</a></td>' +
      '<td>{{{_highlightResult.template.title.value}}}</td>' +
      '<td>{{{_highlightResult.workflowable.client_name.value}}}</td>' +
      '<td>{{{deadline}}}</td>' +
      '<td>{{{completed}}}</td></tr>' +
      '{{/hits}}</tbody>'
    '</div>';
    var search = instantsearch({
      appId: '#{ENV['ALGOLIASEARCH_APPLICATION_ID']}',
      apiKey: '#{@public_key}',
      indexName: '#{Workflow.index_name}',
      urlSync: true
    });
    search.addWidget(
      instantsearch.widgets.searchBox({
        container: '#q',
        placeholder: 'Search for workflows',
        autofocus: false,
        poweredBy: true
      })
    );
    search.addWidget(
      instantsearch.widgets.hits({
        container: '#hits',
        templates: {
          empty: 'No matching workflows',
          allItems: hitTemplate
        },
        hitsPerPage: 10
      })
    );
    search.addWidget(
      instantsearch.widgets.refinementList({
        container: '#templates',
        attributeName: 'template.title',
        limit: 10,
        templates: {
          header: '<div class="card-header"><h5>Templates</h3></div>'
        },
        cssClasses: {
          root: 'card',
          body: 'list-group list-group-flush',
          item: 'list-group-item',
          count: 'badge badge-pill badge-secondary'
        }
      })
    );
    search.start();
  });